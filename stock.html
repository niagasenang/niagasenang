<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Tracker Percuma | NiagaSenang</title>
  <meta name="description" content="Stock Tracker percuma untuk peniaga Malaysia. Track stok masuk/keluar, alert low stock, auto simpan (local), export/import backup JSON.">
  <link rel="stylesheet" href="css/style.css">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P81GM8SJWX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-P81GM8SJWX');
  </script>

  <style>
    .muted { color:#64748b; font-size:13px; }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .grid-3 { display:grid; grid-template-columns:1.2fr 1fr 1fr; gap:12px; }
    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px; }
    .btn-secondary{
      background: rgba(15,118,110,0.12);
      color: #0f766e;
      border: 1px solid rgba(15,118,110,0.25);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
    }
    .btn-secondary:hover { background: rgba(15,118,110,0.18); }
    .pill {
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid #e5e7eb;
      background:#f8fafc;
      color:#0f172a;
    }
    .pill-warn { background: rgba(245,158,11,0.12); border-color: rgba(245,158,11,0.25); color:#b45309; }
    .pill-bad { background: rgba(239,68,68,0.12); border-color: rgba(239,68,68,0.25); color:#b91c1c; }
    .pill-ok { background: rgba(34,197,94,0.12); border-color: rgba(34,197,94,0.25); color:#15803d; }

    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { border-bottom:1px solid #e5e7eb; padding:10px 6px; text-align:left; vertical-align:top; }
    th { font-size:13px; color:#0f172a; }
    td { font-size:14px; }
    .right { text-align:right; }
    .actions { display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; }
    .mini-btn{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#fff;
      cursor:pointer;
    }
    .mini-btn:hover{ background:#f8fafc; }
    .danger{ border-color: rgba(239,68,68,0.35); color:#b91c1c; }
    .danger:hover{ background: rgba(239,68,68,0.08); }

    .box{
      margin-top:12px;
      background:#f8fafc;
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:12px;
    }
    .row { display:flex; justify-content:space-between; gap:10px; margin:8px 0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; color:#64748b; }

    input[type="file"]{
      padding:10px;
      border:1px dashed #cbd5e1;
      border-radius:10px;
      background:#fff;
      width:100%;
    }

    /* ===== Top row (title + language toggle) ===== */
    .top-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .lang-toggle{
      display:flex;
      gap:6px;
      padding:4px;
      border:1px solid #e5e7eb;
      border-radius:999px;
      background:#ffffff;
      flex:0 0 auto;
      margin-top:2px;
    }
    .lang-btn{
      border:0;
      background:transparent;
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:12px;
      cursor:pointer;
      color:#334155;
      line-height:1;
    }
    .lang-btn.active{
      background:#1e293b;
      color:#ffffff;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">

      <div class="top-row">
        <div>
          <h2 data-i18n="h2">üì¶ Stock Tracker (Percuma)</h2>
          <p class="muted" data-i18n="subtitle">
            Track stok masuk/keluar, alert low stock, auto simpan dalam browser (local).
            Ada <strong>Export/Import Backup</strong> kalau tukar phone/laptop.
          </p>
        </div>

        <!-- Language toggle -->
        <div class="lang-toggle" aria-label="Language toggle">
          <button type="button" class="lang-btn" data-lang="ms">BM</button>
          <button type="button" class="lang-btn" data-lang="en">EN</button>
        </div>
      </div>

      <div class="box">
        <div class="row">
          <span><strong data-i18n="statusLabel">Status</strong></span>
          <span class="pill" id="countPill">0 item</span>
        </div>
        <div class="row">
          <span><strong data-i18n="userIdLabel">User ID</strong> <span class="pill">anonymous</span></span>
          <span class="mono" id="userIdTxt">-</span>
        </div>
        <div class="muted" style="margin-top:8px;" data-i18n="tipLine">
          Tip: Jangan padam ‚Äúsite data‚Äù kalau nak simpan stok. Guna Export Backup untuk simpan fail.
        </div>
      </div>

      <hr style="margin:16px 0;">

      <h3 style="margin:0 0 10px 0;" data-i18n="addTitle">‚ûï Tambah Item</h3>

      <div class="grid-3">
        <div>
          <label data-i18n="lblName">Nama Item</label>
          <input id="name" placeholder="Contoh: Serum 30ml">
        </div>
        <div>
          <label data-i18n="lblSku">SKU (optional)</label>
          <input id="sku" placeholder="Contoh: SRM-30">
        </div>
        <div>
          <label data-i18n="lblCat">Kategori (optional)</label>
          <input id="cat" placeholder="Contoh: Skincare">
        </div>
      </div>

      <div class="grid-3" style="margin-top:12px;">
        <div>
          <label data-i18n="lblQty">Stok Semasa</label>
          <input id="qty" type="number" step="1" min="0" placeholder="Contoh: 50">
        </div>
        <div>
          <label data-i18n="lblMin">Low Stock Alert (min)</label>
          <input id="min" type="number" step="1" min="0" placeholder="Contoh: 5">
        </div>
        <div>
          <label data-i18n="lblPrice">Harga Jual (RM) (optional)</label>
          <input id="price" type="number" step="0.01" min="0" placeholder="Contoh: 29.90">
        </div>
      </div>

      <div style="margin-top:14px;">
        <button class="btn" type="button" onclick="addItem()" data-i18n="btnSave">Simpan Item</button>
        <button class="btn-secondary" type="button" onclick="clearForm()" data-i18n="btnClear">Clear</button>
      </div>

      <hr style="margin:16px 0;">

      <div class="toolbar">
        <div style="flex:1; min-width:220px;">
          <label data-i18n="lblSearch">Search</label>
          <input id="search" placeholder="Cari nama / SKU / kategori">
        </div>
        <div style="min-width:180px;">
          <label data-i18n="lblFilter">Filter</label>
          <select id="filter" style="width:100%; padding:10px; border-radius:10px; border:1px solid #cbd5e1;">
            <option value="all" data-i18n-opt="optAll">Semua</option>
            <option value="low" data-i18n-opt="optLow">Low Stock</option>
            <option value="ok" data-i18n-opt="optOk">OK</option>
          </select>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
          <button class="btn-secondary" type="button" onclick="exportBackup()" data-i18n="btnExport">‚¨áÔ∏è Export Backup</button>
          <button class="btn-secondary" type="button" onclick="toggleImport()" data-i18n="btnImport">‚¨ÜÔ∏è Import Backup</button>
        </div>
      </div>

      <div class="box" id="importBox" style="display:none;">
        <strong data-i18n="importTitle">Import Backup (.json)</strong>
        <p class="muted" style="margin-top:6px;" data-i18n="importDesc">
          Pilih fail backup yang kau export sebelum ni. Import akan overwrite data lama.
        </p>
        <input id="file" type="file" accept=".json,application/json">
        <div style="margin-top:10px;">
          <button class="btn" type="button" onclick="importBackup()" data-i18n="btnDoImport">Import</button>
          <button class="btn-secondary" type="button" onclick="toggleImport()" data-i18n="btnCancel">Cancel</button>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th data-i18n="thItem">Item</th>
            <th data-i18n="thSku">SKU</th>
            <th data-i18n="thCat">Kategori</th>
            <th class="right" data-i18n="thStock">Stok</th>
            <th class="right" data-i18n="thAlert">Alert</th>
            <th class="right" data-i18n="thPrice">Harga (RM)</th>
            <th class="right" data-i18n="thActions">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <p style="margin-top:12px; font-size:12px; color:#64748b;">
        <span data-i18n="footerLine">Tool ini disediakan percuma oleh</span> <strong>NiagaSenang</strong>.
      </p>

      <p style="margin-top:18px;">
        <a href="index.html" data-i18n="backLink">‚Üê Kembali ke NiagaSenang</a>
      </p>

    </div>
  </div>

  <script>
    /* =======================
       Language (shared key)
    ======================= */
    const LANG_KEY = "ns_lang";
    let CURRENT_LANG = "ms";

    const I18N = {
      ms: {
        docTitle: "Stock Tracker Percuma | NiagaSenang",
        h2: "üì¶ Stock Tracker (Percuma)",
        subtitle: `Track stok masuk/keluar, alert low stock, auto simpan dalam browser (local).
                  Ada <strong>Export/Import Backup</strong> kalau tukar phone/laptop.`,

        statusLabel: "Status",
        userIdLabel: "User ID",
        tipLine: `Tip: Jangan padam ‚Äúsite data‚Äù kalau nak simpan stok. Guna Export Backup untuk simpan fail.`,

        addTitle: "‚ûï Tambah Item",

        lblName: "Nama Item",
        phName: "Contoh: Serum 30ml",
        lblSku: "SKU (optional)",
        phSku: "Contoh: SRM-30",
        lblCat: "Kategori (optional)",
        phCat: "Contoh: Skincare",

        lblQty: "Stok Semasa",
        phQty: "Contoh: 50",
        lblMin: "Low Stock Alert (min)",
        phMin: "Contoh: 5",
        lblPrice: "Harga Jual (RM) (optional)",
        phPrice: "Contoh: 29.90",

        btnSave: "Simpan Item",
        btnClear: "Clear",

        lblSearch: "Search",
        phSearch: "Cari nama / SKU / kategori",
        lblFilter: "Filter",
        optAll: "Semua",
        optLow: "Low Stock",
        optOk: "OK",

        btnExport: "‚¨áÔ∏è Export Backup",
        btnImport: "‚¨ÜÔ∏è Import Backup",

        importTitle: "Import Backup (.json)",
        importDesc: "Pilih fail backup yang kau export sebelum ni. Import akan overwrite data lama.",
        btnDoImport: "Import",
        btnCancel: "Cancel",

        thItem: "Item",
        thSku: "SKU",
        thCat: "Kategori",
        thStock: "Stok",
        thAlert: "Alert",
        thPrice: "Harga (RM)",
        thActions: "Actions",

        footerLine: "Tool ini disediakan percuma oleh",
        backLink: "‚Üê Kembali ke NiagaSenang",

        // UI strings
        emptyRow: "Tiada item lagi. Tambah item di atas üëÜ",
        statusLow: "Low",
        statusOk: "OK",
        statusOut: "Habis",

        // alerts / confirms
        aNeedName: "Isi Nama Item dulu.",
        aBackupDownloaded: "‚úÖ Backup downloaded. Simpan file ni (Google Drive pun boleh).",
        aPickJson: "Pilih fail .json dulu.",
        aInvalidBackup: "Fail backup tidak valid.",
        aOverwriteConfirm: "Import akan overwrite data stok sedia ada. Teruskan?",
        aImportSuccess: "‚úÖ Import berjaya.",
        aBackupCorrupt: "Fail backup tidak valid / rosak.",
        aDeleteConfirm: "Delete item ni?",

        // prompts
        pName: "Nama Item:",
        pSku: "SKU (optional):",
        pCat: "Kategori (optional):",
        pQty: "Stok Semasa:",
        pMin: "Low Stock Alert (min):",
        pPrice: "Harga Jual (RM) (optional):"
      },

      en: {
        docTitle: "Free Stock Tracker | NiagaSenang",
        h2: "üì¶ Stock Tracker (Free)",
        subtitle: `Track stock in/out, low-stock alerts, and auto-save in your browser (local).
                  Includes <strong>Export/Import Backup</strong> when you switch devices.`,

        statusLabel: "Status",
        userIdLabel: "User ID",
        tipLine: `Tip: Don‚Äôt clear ‚Äúsite data‚Äù if you want to keep your stock. Use Export Backup to save a file.`,

        addTitle: "‚ûï Add Item",

        lblName: "Item Name",
        phName: "Example: Serum 30ml",
        lblSku: "SKU (optional)",
        phSku: "Example: SRM-30",
        lblCat: "Category (optional)",
        phCat: "Example: Skincare",

        lblQty: "Current Stock",
        phQty: "Example: 50",
        lblMin: "Low Stock Alert (min)",
        phMin: "Example: 5",
        lblPrice: "Selling Price (RM) (optional)",
        phPrice: "Example: 29.90",

        btnSave: "Save Item",
        btnClear: "Clear",

        lblSearch: "Search",
        phSearch: "Search name / SKU / category",
        lblFilter: "Filter",
        optAll: "All",
        optLow: "Low Stock",
        optOk: "OK",

        btnExport: "‚¨áÔ∏è Export Backup",
        btnImport: "‚¨ÜÔ∏è Import Backup",

        importTitle: "Import Backup (.json)",
        importDesc: "Choose your previous exported backup file. Import will overwrite existing data.",
        btnDoImport: "Import",
        btnCancel: "Cancel",

        thItem: "Item",
        thSku: "SKU",
        thCat: "Category",
        thStock: "Stock",
        thAlert: "Alert",
        thPrice: "Price (RM)",
        thActions: "Actions",

        footerLine: "This tool is provided for free by",
        backLink: "‚Üê Back to NiagaSenang",

        emptyRow: "No items yet. Add an item above üëÜ",
        statusLow: "Low",
        statusOk: "OK",
        statusOut: "Out",

        aNeedName: "Please enter Item Name first.",
        aBackupDownloaded: "‚úÖ Backup downloaded. Save this file (Google Drive works too).",
        aPickJson: "Please choose a .json file first.",
        aInvalidBackup: "Invalid backup file.",
        aOverwriteConfirm: "Import will overwrite your current stock data. Continue?",
        aImportSuccess: "‚úÖ Import successful.",
        aBackupCorrupt: "Invalid / corrupted backup file.",
        aDeleteConfirm: "Delete this item?",

        pName: "Item Name:",
        pSku: "SKU (optional):",
        pCat: "Category (optional):",
        pQty: "Current Stock:",
        pMin: "Low Stock Alert (min):",
        pPrice: "Selling Price (RM) (optional):"
      }
    };

    function detectBrowserLang(){
      const nav = (navigator.language || "").toLowerCase();
      return nav.startsWith("en") ? "en" : "ms";
    }

    function t(key){
      const pack = I18N[CURRENT_LANG] || I18N.ms;
      return (pack[key] != null) ? pack[key] : (I18N.ms[key] ?? "");
    }

    function applyLang(lang){
      CURRENT_LANG = (lang === "en") ? "en" : "ms";
      localStorage.setItem(LANG_KEY, CURRENT_LANG);

      document.documentElement.setAttribute("lang", CURRENT_LANG === "en" ? "en" : "ms");
      document.title = t("docTitle");

      document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.lang === CURRENT_LANG);
      });

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        const val = t(key);
        if (val != null && val !== "") el.innerHTML = val;
      });

      // select options
      document.querySelectorAll("[data-i18n-opt]").forEach(opt => {
        const key = opt.getAttribute("data-i18n-opt");
        const val = t(key);
        if (val != null && val !== "") opt.textContent = val;
      });

      // placeholders
      name.placeholder = t("phName");
      sku.placeholder = t("phSku");
      cat.placeholder = t("phCat");
      qty.placeholder = t("phQty");
      min.placeholder = t("phMin");
      price.placeholder = t("phPrice");
      search.placeholder = t("phSearch");

      // refresh UI-dependent strings
      render();
    }

    (function initLang(){
      const saved = localStorage.getItem(LANG_KEY);
      const start = saved || detectBrowserLang();
      applyLang(start);

      document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.addEventListener("click", () => applyLang(btn.dataset.lang));
      });
    })();

    /* =======================
       App logic
    ======================= */
    const LS_DATA = "ns_stock_data_v1";
    const LS_UID  = "ns_stock_uid_v1";

    function makeId(){ return "ns_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16); }
    function getUid(){
      let uid = localStorage.getItem(LS_UID);
      if(!uid){ uid = makeId(); localStorage.setItem(LS_UID, uid); }
      return uid;
    }

    function readData(){
      const raw = localStorage.getItem(LS_DATA);
      if(!raw) return [];
      try{ const data = JSON.parse(raw); return Array.isArray(data) ? data : []; }
      catch(e){ return []; }
    }
    function saveData(items){ localStorage.setItem(LS_DATA, JSON.stringify(items)); }

    function money(n){ return Number(n||0).toFixed(2); }
    function val(id){ return (document.getElementById(id).value || "").trim(); }
    function numVal(id){
      const n = Number(document.getElementById(id).value);
      return isNaN(n) ? 0 : n;
    }

    function clearForm(){
      ["name","sku","cat","qty","min","price"].forEach(id => document.getElementById(id).value = "");
      document.getElementById("name").focus();
    }

    function addItem(){
      const itemName = val("name");
      if(!itemName){ alert(t("aNeedName")); return; }

      const item = {
        id: "it_" + Math.random().toString(16).slice(2),
        name: itemName,
        sku: val("sku"),
        cat: val("cat"),
        qty: Math.max(0, Math.floor(numVal("qty"))),
        min: Math.max(0, Math.floor(numVal("min"))),
        price: Math.max(0, Number(numVal("price"))),
        updatedAt: Date.now()
      };

      const items = readData();
      items.unshift(item);
      saveData(items);
      render();

      // ‚úÖ EVENT: stock_add_item
      try {
        gtag('event','stock_add_item',{ event_category:'tools', event_label:'stock' });
      } catch(e){}

      clearForm();
    }

    function escapeHtml(str){
      return String(str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function statusPill(item){
      if(item.qty <= item.min && item.min > 0){
        if(item.qty === 0) return `<span class="pill pill-bad">${escapeHtml(t("statusOut"))}</span>`;
        return `<span class="pill pill-warn">${escapeHtml(t("statusLow"))}</span>`;
      }
      return `<span class="pill pill-ok">${escapeHtml(t("statusOk"))}</span>`;
    }

    function matches(item, q){
      const s = (q || "").toLowerCase();
      if(!s) return true;
      return (
        (item.name || "").toLowerCase().includes(s) ||
        (item.sku  || "").toLowerCase().includes(s) ||
        (item.cat  || "").toLowerCase().includes(s)
      );
    }

    function passFilter(item, f){
      if(f === "low") return (item.min > 0 && item.qty <= item.min);
      if(f === "ok") return !(item.min > 0 && item.qty <= item.min);
      return true;
    }

    function render(){
      const uid = getUid();
      document.getElementById("userIdTxt").textContent = uid;

      const q = (document.getElementById("search").value || "").trim();
      const f = document.getElementById("filter").value;

      const items = readData();
      document.getElementById("countPill").textContent = items.length + " item";

      const rows = items
        .filter(it => matches(it, q))
        .filter(it => passFilter(it, f))
        .map(it => `
          <tr>
            <td>
              <strong>${escapeHtml(it.name)}</strong>
              <div class="muted" style="margin-top:4px;">${statusPill(it)} <span class="mono">updated: ${new Date(it.updatedAt).toLocaleString()}</span></div>
            </td>
            <td>${escapeHtml(it.sku || "-")}</td>
            <td>${escapeHtml(it.cat || "-")}</td>
            <td class="right"><strong>${Number(it.qty || 0)}</strong></td>
            <td class="right">${Number(it.min || 0)}</td>
            <td class="right">${it.price ? money(it.price) : "-"}</td>
            <td class="right">
              <div class="actions">
                <button class="mini-btn" onclick="adjustQty('${it.id}', 1)">+1</button>
                <button class="mini-btn" onclick="adjustQty('${it.id}', -1)">-1</button>
                <button class="mini-btn" onclick="editItem('${it.id}')">Edit</button>
                <button class="mini-btn danger" onclick="deleteItem('${it.id}')">Delete</button>
              </div>
            </td>
          </tr>
        `).join("");

      document.getElementById("tbody").innerHTML = rows || `
        <tr><td colspan="7" class="muted" style="padding:14px;">${escapeHtml(t("emptyRow"))}</td></tr>
      `;
    }

    function adjustQty(id, delta){
      const items = readData();
      const it = items.find(x => x.id === id);
      if(!it) return;
      it.qty = Math.max(0, Number(it.qty || 0) + delta);
      it.updatedAt = Date.now();
      saveData(items);
      render();
    }

    function editItem(id){
      const items = readData();
      const it = items.find(x => x.id === id);
      if(!it) return;

      const name = prompt(t("pName"), it.name); if(name === null) return;
      const sku = prompt(t("pSku"), it.sku || ""); if(sku === null) return;
      const cat = prompt(t("pCat"), it.cat || ""); if(cat === null) return;
      const qty = prompt(t("pQty"), String(it.qty || 0)); if(qty === null) return;
      const min = prompt(t("pMin"), String(it.min || 0)); if(min === null) return;
      const price = prompt(t("pPrice"), it.price ? String(it.price) : ""); if(price === null) return;

      it.name = (name || "").trim() || it.name;
      it.sku = (sku || "").trim();
      it.cat = (cat || "").trim();
      it.qty = Math.max(0, Math.floor(Number(qty || 0)));
      it.min = Math.max(0, Math.floor(Number(min || 0)));
      it.price = Math.max(0, Number(price || 0));
      it.updatedAt = Date.now();

      saveData(items);
      render();
    }

    function deleteItem(id){
      if(!confirm(t("aDeleteConfirm"))) return;
      const items = readData().filter(x => x.id !== id);
      saveData(items);
      render();
    }

    function exportBackup(){
      const payload = {
        app: "NiagaSenang Stock Tracker",
        version: 1,
        exportedAt: new Date().toISOString(),
        userId: getUid(),
        items: readData()
      };

      const json = JSON.stringify(payload, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      const ts = new Date();
      const y = ts.getFullYear();
      const m = String(ts.getMonth()+1).padStart(2,"0");
      const d = String(ts.getDate()).padStart(2,"0");

      a.href = url;
      a.download = `niagasenang-stock-backup-${y}${m}${d}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      alert(t("aBackupDownloaded"));

      try {
        gtag('event','stock_export_backup',{ event_category:'tools', event_label:'stock' });
      } catch(e){}
    }

    function toggleImport(){
      const box = document.getElementById("importBox");
      box.style.display = (box.style.display === "none" || !box.style.display) ? "block" : "none";
    }

    function importBackup(){
      const fileInput = document.getElementById("file");
      const file = fileInput.files && fileInput.files[0];
      if(!file){ alert(t("aPickJson")); return; }

      const reader = new FileReader();
      reader.onload = () => {
        try{
          const payload = JSON.parse(reader.result);
          if(!payload || !Array.isArray(payload.items)){ alert(t("aInvalidBackup")); return; }
          if(!confirm(t("aOverwriteConfirm"))) return;

          const uid = payload.userId || getUid();
          localStorage.setItem(LS_UID, uid);
          saveData(payload.items);
          render();
          toggleImport();
          fileInput.value = "";
          alert(t("aImportSuccess"));

          try {
            gtag('event','stock_import_backup',{ event_category:'tools', event_label:'stock' });
          } catch(e){}
        }catch(e){
          alert(t("aBackupCorrupt"));
        }
      };
      reader.readAsText(file);
    }

    document.getElementById("search").addEventListener("input", render);
    document.getElementById("filter").addEventListener("change", render);

    (function init(){
      getUid();
      render();
    })();
  </script>
</body>
</html>